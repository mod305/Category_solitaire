<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>카테고리 솔리테어</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --text-color: #ffffff;
            --card-width: 100px;
            --card-height: 140px;
            --gap: 16px;
            --primary-font: 'Noto Sans KR', sans-serif;
            --card-radius: 12px;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-border-subtle: rgba(255, 255, 255, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--primary-font);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* 
           Layout Strategy: 
           3-Column Grid: [Left: Turn] [Center: Game Board] [Right: Deck]
           This ensures the Game Board (Sorting + Tableau) is isolated and aligned perfectly.
        */
        #app {
            display: grid;
            grid-template-columns: 140px auto 260px;
            gap: 40px;
            padding: 24px;
            max-width: 1400px;
            width: 100%;
            height: 90vh;
            align-items: start;
        }

        /* LEFT PANEL */
        .left-panel {
            display: flex;
            justify-content: flex-start;
            padding-top: 30px;
            /* Visual alignment with top slots */
        }

        .turn-counter {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: var(--card-width);
            height: var(--card-height);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border-subtle);
            border-radius: var(--card-radius);
            backdrop-filter: blur(10px);
        }

        .turn-counter .label {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .turn-counter .value {
            font-size: 2rem;
            font-weight: 800;
        }

        .restart-btn {
            width: var(--card-width);
            height: 40px;
            background: rgba(255, 82, 82, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--card-radius);
            color: white;
            font-family: var(--primary-font);
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 16px;
            /* Space between button and counter */
            transition: background 0.2s;
        }

        .restart-btn:hover {
            background: rgba(255, 82, 82, 1);
        }

        /* CENTER BOARD */
        .center-board {
            display: flex;
            flex-direction: column;
            gap: 40px;
            /* Vertical gap between Sorting Area and Tableau Area */
            align-items: center;
            width: 100%;
        }

        /* 
           Crucial for Alignment:
           Both Sorting Area and Tableau Area use the SAME Grid configuration.
           This creates a "Room" of identical width and column positions.
        */
        .sorting-area,
        .tableau-area {
            display: grid;
            grid-template-columns: repeat(4, var(--card-width));
            gap: var(--gap);
            justify-content: center;
            width: 100%;
        }

        /* Tableau area needs height for the columns to expand downwards */
        .tableau-area {
            min-height: 400px;
            align-items: start;
        }

        /* RIGHT PANEL */
        .right-panel {
            display: flex;
            justify-content: flex-end;
            padding-top: 30px;
        }

        .deck-area {
            display: flex;
            gap: var(--gap);
        }

        /* SLOTS & COLUMNS */
        .slot {
            width: var(--card-width);
            height: var(--card-height);
            border: 2px dashed var(--glass-border-subtle);
            border-radius: var(--card-radius);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .sorting-slot::before {
            content: attr(data-label);
            position: absolute;
            top: -50px;
            width: 100%;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-color);
            white-space: pre;
            line-height: 1.4;
        }

        .tableau-column {
            display: flex;
            flex-direction: column;
            width: var(--card-width);
            position: relative;
        }

        .slot-base {
            width: 100%;
            height: var(--card-height);
            border-radius: var(--card-radius);
            background: rgba(0, 0, 0, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            /* Brighter Dashed Border */
        }

        /* --- CARD STYLING --- */
        .card {
            width: var(--card-width);
            height: var(--card-height);
            border-radius: var(--card-radius);
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            cursor: grab;
            position: absolute;
            transition: top 0.2s ease, transform 0.2s ease;

            display: flex;
            flex-direction: column;
            justify-content: center;
            /* Default: Center aligned */
            align-items: center;
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
            padding-top: 10px;
            /* Space for label visibility */

            background-color: white;
            z-index: 10;
        }

        .card.key-card {
            background-color: #ffffff;
            border: 3px solid #ff5252;
            color: #d32f2f;
            font-weight: 900;
            font-weight: 900;
            justify-content: space-between;
            padding-top: 15px;
            /* Keep specific padding for Key Card */
            padding-bottom: 5px;
        }

        /* Key Card Counter */
        .key-counter {
            font-size: 0.8rem;
            color: #d32f2f;
            opacity: 0.8;
            margin-top: 5px;
        }

        .card.sub-card {
            background-color: #ffffff;
            border: 2px solid #448aff;
            color: #333;
        }

        /* When a card is stacked under another (Tableau), align to top to show label */
        .card.stacked-view {
            justify-content: flex-start !important;
            padding-top: 8px;
        }

        .card:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 100 !important;
        }

        .card.back {
            background-color: #E0D7D0;
            border: 2px solid #BCAAA4;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        /* Improved Rabbit Icon */
        .card.back .rabbit-icon {
            width: 60%;
            height: 60%;
            background-color: #3e2723;
            -webkit-mask: url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,2C12,2 8,5 8,10C8,11.5 8.5,13 9,14C7,14 4,16 4,19C4,21 6,22 12,22C18,22 20,21 20,19C20,16 17,14 15,14C15.5,13 16,11.5 16,10C16,5 12,2 12,2M12,5C12.8,5 13.5,7 13.8,9C13.2,8.8 12.6,8.8 12,8.8C11.4,8.8 10.8,8.8 10.2,9C10.5,7 11.2,5 12,5Z"/></svg>') no-repeat center;
            -webkit-mask-size: contain;
            mask: url('data:image/svg+xml;utf8,<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12,2C12,2 8,5 8,10C8,11.5 8.5,13 9,14C7,14 4,16 4,19C4,21 6,22 12,22C18,22 20,21 20,19C20,16 17,14 15,14C15.5,13 16,11.5 16,10C16,5 12,2 12,2M12,5C12.8,5 13.5,7 13.8,9C13.2,8.8 12.6,8.8 12,8.8C11.4,8.8 10.8,8.8 10.2,9C10.5,7 11.2,5 12,5Z"/></svg>') no-repeat center;
            mask-size: contain;
        }

        .card.back span.label {
            display: none;
        }

        /* --- DIFFICULTY UI --- */
        .difficulty-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        .diff-btn {
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.75rem;
            cursor: pointer;
            color: white;
            opacity: 0.6;
            transition: all 0.2s;
            font-weight: bold;
        }

        .diff-btn.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .diff-easy {
            background-color: #4CAF50;
        }

        /* Green */
        .diff-normal {
            background-color: #2196F3;
        }

        /* Blue */
        .diff-hard {
            background-color: #FF9800;
        }

        /* Orange */
        .diff-extreme {
            background-color: #E91E63;
        }

        /* Pink */

        /* --- MOBILE RESPONSIVE --- */

        /* 1. PORTRAIT (Vertical Layout) - Optimized for One Hand / Long View */
        @media (max-width: 768px) and (orientation: portrait) {
            :root {
                /* Use vmin to ensure it fits width */
                --card-width: 20vw;
                --card-height: 28vw;
                /* Ratio 1.4 */
                --gap: 2vw;
                --card-radius: 4px;
            }

            #app {
                display: flex;
                flex-direction: column;
                height: 100vh;
                height: 100dvh;
                /* Dynamic Viewport Height for mobile browsers */
                padding: 10px 5px;
                gap: 10px;
                overflow: hidden;
                /* Prevent body scroll, handle inside tableau */
                box-sizing: border-box;
            }

            /* TOP: Control Bar (Turns, Restart) */
            .left-panel {
                width: 100%;
                height: 40px;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 0 10px;
                order: 1;
                flex: none;
            }

            .left-panel>div {
                flex-direction: row !important;
                width: auto;
                gap: 10px;
            }

            .turn-counter {
                height: auto;
                padding: 5px 10px;
                flex-direction: row;
            }

            .restart-btn {
                margin: 0;
                padding: 5px 10px;
                width: auto;
                font-size: 0.8rem;
            }

            /* MIDDLE: Board */
            .center-board {
                width: 100%;
                order: 2;
                flex: 1;
                /* Take remaining space */
                gap: 10px;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                /* Contain inner scroll */
            }

            .sorting-area {
                /* Top of Board */
                grid-template-columns: repeat(4, var(--card-width));
                gap: var(--gap);
                padding-bottom: 5px;
                flex: none;
                /* Fixed height */
                justify-content: center;
            }

            .tableau-area {
                /* Main Area */
                grid-template-columns: repeat(4, var(--card-width));
                gap: var(--gap);
                flex: 1;
                overflow-y: auto;
                /* Scroll ONLY the tableau columns if needed */
                min-height: 0;
                justify-content: center;
                padding-top: 10px;
            }

            /* Remove Bases visual noise in compact mode */
            .slot-base {
                border-color: rgba(255, 255, 255, 0.1);
            }

            /* BOTTOM: Deck & Grave */
            .right-panel {
                order: 3;
                width: 100%;
                height: 90px;
                /* Fixed height for touch target */
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 30px;
                padding: 0;
                flex: none;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 12px;
            }

            /* Adjust Fonts */
            .card {
                font-size: 0.75rem;
                padding: 2px;
                border-width: 1px;
            }

            .label {
                font-size: 0.7rem !important;
            }

            .key-counter {
                font-size: 0.6rem;
                bottom: 2px;
                right: 2px;
            }

            .sorting-slot::before {
                display: none;
            }

            /* Hide helper text on mobile to save space */
        }

        /* 2. LANDSCAPE (Horizontal Layout) - Scaled Down Desktop View */
        @media (max-width: 900px) and (orientation: landscape) {
            :root {
                /* Smaller fixed size for landscape mobile */
                --card-width: 60px;
                --card-height: 84px;
                --gap: 8px;
            }

            #app {
                display: grid;
                grid-template-columns: 80px 1fr 100px;
                /* Compact columns */
                height: 100vh;
                height: 100dvh;
                padding: 5px;
                gap: 5px;
                overflow: hidden;
            }

            /* Left: Controls */
            .left-panel {
                order: 1;
                padding: 0;
                justify-content: center;
            }

            .turn-counter {
                width: 100%;
                padding: 5px;
                font-size: 0.8rem;
            }

            .restart-btn {
                width: 100%;
                margin-top: 10px;
                padding: 5px;
                font-size: 0.8rem;
            }

            /* Center: Board */
            .center-board {
                order: 2;
                gap: 5px;
            }

            .sorting-area,
            .tableau-area {
                grid-template-columns: repeat(4, var(--card-width));
                gap: var(--gap);
                justify-content: center;
            }

            .tableau-area {
                padding-top: 10px;
                overflow-y: auto;
            }

            /* Right: Deck */
            .right-panel {
                order: 3;
                padding: 10px 0;
                gap: 15px;
            }

            .card {
                font-size: 0.7rem;
            }

            .label {
                font-size: 0.65rem !important;
            }

            .sorting-slot::before {
                opacity: 0.5;
                font-size: 0.6rem;
                top: -15px;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- 1. LEFT PANEL: Turn Counter -->
        <div class="left-panel">
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <!-- Difficulty Selector -->
                <div class="difficulty-selector" id="diff-selector">
                    <button class="diff-btn diff-easy" data-diff="EASY">쉬움</button>
                    <button class="diff-btn diff-normal active" data-diff="NORMAL">보통</button>
                    <button class="diff-btn diff-hard" data-diff="HARD">어려움</button>
                    <button class="diff-btn diff-extreme" data-diff="EXTREME">극악</button>
                </div>

                <div style="display: flex; flex-direction: row; gap: 10px; align-items: center;">
                    <button id="restart-btn" class="restart-btn">재시작</button>
                    <div class="turn-counter">
                        <span class="label">남은 턴</span>
                        <span id="turns-value" class="value">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. CENTER BOARD: Sorting & Tableau -->
        <div class="center-board">
            <!-- Row 1: Sorting Slots -->
            <div id="sorting-area" class="sorting-area">
                <!-- Sorting Slots generated by JS -->
            </div>

            <!-- Row 2: Tableau Columns -->
            <div id="tableau-area" class="tableau-area">
                <!-- Deployment Slots -->
            </div>
        </div>

        <!-- 3. RIGHT PANEL: Deck & Graveyard -->
        <div class="right-panel">
            <div class="deck-area">
                <!-- Discard Pile (Open) -->
                <div id="graveyard" class="slot" style="border-style: solid; border-color: rgba(255,255,255,0.1);">
                    <!-- Face Up Cards go here -->
                </div>

                <!-- Draw Pile (Hidden) -->
                <div id="deck-pile" class="slot" style="border: none;">
                    <!-- Face Down Cards go here -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/game.js"></script>
</body>

</html>